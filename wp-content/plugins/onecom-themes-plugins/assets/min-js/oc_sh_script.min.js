!function(i){let o={ajaxurl:oc_constants.ajaxurl,checks:oc_constants.checks,counts:{todo:0,done:0,ignored:0,critical:0,hidden:0},currentScreen:oc_constants.current_screen,emptyListMessages:oc_constants.empty_list_messages,howToFixKey:"How to fix",revertKey:"Revert",spinner:'<span class="components-spinner"></span>',text:oc_constants.text,totalChecks:oc_constants.checks.length,upgradeText:oc_constants.upgrade_modal_text,actionTaken:function(e){return 0<i(e).parent().find(".components-spinner").length},calculateScore:function(){var e=this,t=parseInt(i(".done .ocsh-bullet").length)+parseInt(i(".ocsh-bullet.ocsh-fix-success").length),o=parseInt(i(".todo .ocsh-bullet").length)-parseInt(i(".ocsh-bullet.ocsh-fix-success").length);parseInt(i(".ignored .ocsh-bullet").length);let n=Math.floor(100*t/(e.totalChecks-e.counts.hidden)),s="poor";return"100.00"==n&&(n=100),75<n?s="good":n<=75&&50<=n&&(s="ok"),this.saveResult(n),e.counts.todo=o,{score:`<span class="${s}">${n}%</span>`,todoCount:o}},deleteFile:function(t){let o=this;var e=i(t).attr("data-file");e&&(i(t).removeAttr("data-file"),i.post(ajaxurl,{action:"ocsh_delete_file",file:e},function(e){i(t).text(e.title),i(t).addClass("ocsh-processed"),1===i(t).parents(".ocsh-desc-li").find(".ocsh-delete-link").length&&o.moveListItem(i(t),i("ul.done"))}))},emptyListTemplate:function(e=""){return`<div class="onecom_empty_list"><div class="onecom_empty_list__image"><img src="${oc_constants.asset_url}/modules/health-monitor/assets/images/wp-hosting.svg"></div><div><p class="onecom_empty_list__text">${e}</p></div>`},handleTabClick:function(e){var t=i(e).attr("data-tab");i(".onecom_tabs_panel").fadeOut("fast"),i(e).parent().find(".active").removeClass("active"),i(e).addClass("active"),i(".onecom_tabs_panels #"+t).fadeIn("fast")},hideLoader:function(e){e&&i(e).parent().find(".components-spinner").remove()},ignoreCheck:function(o){let n=this;var e=i(o).data("check");i(n).hasClass("ocsh-open-modal")?n.showModal():(n.showLoader(o),i(n).removeClass("oc-mark-resolved"),i.post(n.ajaxurl,{action:"ocsh_mark_resolved",check:e},function(e){n.hideLoader(o),i(n).text(e.title),i(o).parents("li.ocsh-bullet").find(".oc-mark-resolved").addClass("onecom_unignore").removeClass("oc-mark-resolved").text(n.text.unignore);let t=i(o).parents("li.ocsh-bullet");t.toggleClass("expanded"),t.find(".ocsh-desc-wrap").toggleClass("hidden"),i(o).parents("li.ocsh-bullet").appendTo(i("ul.ignored")),i("#ignored_count").html(++n.counts.ignored),i("#todo_count").html(--n.counts.todo),i("#onecom_card_todo_score").html(n.counts.todo),n.updateListStatus()}))},moveListItem:function(e,t){let o;o=e.hasClass("ocsh-bullet")?e:i(e).parents("li.ocsh-bullet"),o.toggleClass("expanded"),o.find(".ocsh-desc-wrap").toggleClass("hidden"),t.hasClass("done")||o.appendTo(t),this.counts.todo=parseInt(i(".todo .ocsh-bullet").length)-parseInt(i(".todo .ocsh-bullet.ocsh-fix-success").length),this.counts.done=parseInt(i(".done .ocsh-bullet").length)+parseInt(i(".ocsh-bullet.ocsh-fix-success").length),this.counts.ignored=parseInt(i(".ignored .ocsh-bullet").length)-parseInt(i(".ignored .ocsh-bullet.ocsh-fix-success").length),i("#todo_count").text(this.counts.todo),i("#onecom_card_todo_score").text(this.counts.todo),i("#done_count").text(this.counts.done),i("#ignored_count").text(this.counts.ignored);t=this.calculateScore();i("#onecom_card_result").html(t.score),this.updateListStatus()},quickFix:function(a){if(!a.attr("href"))if(a.data("url")&&a.data(url).length)window.open(a.data("url"),"CP");else{let c=this,o={},n=!1;var e=i(a).parents(".ocsh-bullet").find("input");if(e.length&&i.each(e,function(e,t){if(i(t).text("").removeClass("ocsh-error-field"),i(t).parent().find(".oc-error-message").fadeOut(),""==i(t).val()){let e=oc_constants.error_empty;"oc_hm_site_key"===i(t).attr("name")&&(e=oc_constants.error_empty_sitekey),i(t).parent().find(".oc-error-message").text(e).fadeIn(),i(t).addClass("ocsh-error-field"),n=!0}else i(t).val().length<40&&(i(t).parent().find(".oc-error-message").text(oc_constants.error_length).fadeIn(),i(t).addClass("ocsh-error-field"),n=!0);o[i(t).attr("name")]=i(t).val()}),!n){let s=i(a).data("check");s&&(c.showLoader(a),i.post(c.ajaxurl,{action:`ocsh_fix_${s}`,inputs:o},function(t){if("0"==t.status){i(a).attr("disabled","disabled");try{let e=i(a).parents(".ocsh-bullet");var o,n;e.find(".onecom__scan_content__wrap").html(t.desc),"1"==e.data("undo")?(e.find(".ocsh-actions").html(`<a href="javascript:void(0)" class="onecom__revert_action" data-check="${s}">${c.revertKey}</a>`),o=e.find(".onecom_tag").clone(),n=e.find(".onecom__scan-title-bg").html(),e.data("old-title",n),e.find(".onecom__scan-title-bg").html(t.desc),e.find(".onecom__scan-title-bg").append(o),e.find(".onecom__scan-title-bg").append(`<a href="javascript:void(0)" class="onecom__revert_action" data-check="${s}"> ${c.revertKey}</a>`),e.find(".onecom_tag").hide()):e.find(".ocsh-actions").remove(),e.find(".onecom__how_to_fix_wrap").remove(),e.addClass("ocsh-fix-success"),c.moveListItem(e,i("ul.done"))}catch(e){console.info(e.message)}}}))}}},revert:function(s){let c=this,a=i(s).attr("data-check");a&&(c.showLoader(s),i.post(c.ajaxurl,{action:"ocsh_undo_"+a},function(t){if("0"==t.status){i(s).attr("disabled","disabled");try{let e=i(s).parents(".ocsh-bullet");e.find(".onecom__revert_action").remove(),e.find(".components-spinner").remove(),e.removeClass("ocsh-fix-success"),e.find(".onecom__scan_content__wrap").html(t.desc),""!=e.data("old-title")&&e.find(".onecom__scan-title-bg").html(e.data("old-title"));var o=`<span class="onecom__how_to_fix_wrap"><h4 class="ocsh-scan-title onecom__fix_title">${c.howToFixKey}</h4>${t.how_to_fix}</span>`,n=`<div class="ocsh-actions"><span class="ocsh-fix-wrap"><button class="oc-fix-button" data-check="${a}">${t.fix_button_text}</button></span><span class="ocsh-resolve-wrap"><a class=" oc-mark-resolved" data-check="${a}">${t.ignore_text}</a></span></div>`;e.find(".ocsh-actions").html(n),e.find(".osch-desc").append(o),c.moveListItem(e,i("ul.todo"))}catch(e){console.info(e.message)}}c.hideLoader(s)}))},runCheck:function(o){let n=this,e={action:"ocsh_check_"+this.checks[o]};"error_reporting"===this.checks[o]&&(e.err=i(".onecom_tabs_container").data("error")),i.post(this.ajaxurl,e,function(e){++o<n.checks.length&&n.runCheck(o);try{switch(e.status){case 0:i("ul.done").append(e.html),n.counts.done++,i("#done_count").text(n.counts.done);break;case 1:i("ul.todo").append(e.html),n.counts.todo++,i("#todo_count").text(n.counts.todo);break;case 2:n.counts.hidden++;break;case 3:i("ul.ignored").append(e.html),n.counts.ignored++,i("#ignored_count").text(n.counts.ignored);break;case 4:i("ul.critical").append(e.html),n.counts.todo++,i("#todo_count").text(n.counts.todo)}}catch(e){console.info(e.message)}var t;o===n.checks.length&&(n.updateListStatus(),t=n.calculateScore(),i("#onecom_card_result").html(t.score),i("#onecom_card_todo_score").text(n.counts.todo))})},saveResult:function(e){let t="#4ab865";t="#dc3232";let o='<i style="color:'+t+'">'+Number(10).toFixed(0)+"%</i> ";i.post(ajaxurl,{action:"ocsh_save_result",osch_Result:10},function(e){var t=i("#ocsh-site-security").text();i("#ocsh-site-security").html(t+" - "+o+'<a class="button" href="'+oc_constants.ocsh_page_url+'">'+oc_constants.ocsh_scan_btn+"</a>")})},saveUser:function(t){let o=this;var e,n,s=i(t).parent().find(".onecom__input_user").val();""!=s?(e=i(t).data("user"),n=i(t).data("nonce"),o.showLoader(i(t)),i.post(o.ajaxurl,{action:"ocsh_change_username",username:s,oldUser:e,_ajax_nonce:n},function(e){1==e.status&&i(t).parent().find(".onecom__input_user").addClass("onecom__error"),"0"==e.status&&(1===(e=i(t).parents(".ocsh-desc-li").find(".onecom__input_user")).length?o.moveListItem(i(t),i("ul.done")):i(e).slideUp().remove()),o.hideLoader(i(t))})):i(t).parent().find(".onecom__input_user").addClass("onecom__error")},showFields:function(e){i(e).parent().find(".oc_hidden").show()},showConfirmation:function(e){i("#oc_um_body").html(e.title||e.desc||""),i("#oc_um_head").hide(),i("#oc_phased-in").hide(),i(".oc_up_btn").hide(),i("#oc_um_overlay").show(),i("#oc_um_wrapper").css("min-height","auto").css("min-width","auto"),i(".oc_cancel_btn").css("margin","0").addClass("oc_up_btn").text("Close"),i(".oc_cancel_btn").show()},showLoader:function(e=null){e&&0===i(e).parent().find(".components-spinner").length&&i(e).parent().append(this.spinner)},showModal:function(e){i("#oc_um_head h5").text(this.upgradeText.title),i("#oc_um_body").html(this.upgradeText.body),i("#oc_um_overlay").show(),i("body").addClass("oc-noscroll");ocSetModalData({isPremium:!0,feature:"health_monitor",plugin:"onecom-themes-plugin",featureAction:e,referrer:""})},startScan:function(){this.checks&&this.checks.length&&"_page_onecom-wp-health-monitor"===this.currentScreen&&(i("#onecom_card_result").html(this.spinner),i("#onecom_card_todo_score").html(this.spinner),this.runCheck(0))},scrollMenu:function(){if(i(".h-parent").length){const s=document.querySelector(".h-parent");let t=!1,o,n;s.addEventListener("mousedown",e=>{t=!0,s.classList.add("active"),o=e.pageX-s.offsetLeft,n=s.scrollLeft}),s.addEventListener("mouseleave",()=>{t=!1,s.classList.remove("active")}),s.addEventListener("mouseup",()=>{t=!1,s.classList.remove("active")}),s.addEventListener("mousemove",e=>{t&&(e.preventDefault(),e=3*(e.pageX-s.offsetLeft-o),s.scrollLeft=n-e,console.log(e))})}},toggleBullet:function(e,t=null){i(t.target).hasClass("onecom__scan-title-bg")&&(i(t.target).parents(".ocsh-bullet").hasClass("ocsh-fix-success")||(i(e).toggleClass("expanded"),i(e).find(".ocsh-desc-wrap").toggleClass("hidden")))},unIgnore:function(n){let s=this,c=i("ul.todo");var e=i(n).data("check");""!=e&&(i(s).hasClass("ocsh-open-modal")?s.showModal(e):(i(s).removeClass("onecom_unignore"),s.showLoader(n),i.post(s.ajaxurl,{action:"onecom_unignore",check:e},function(e){s.hideLoader(n),i("ul.todo").append(i(n).parents("li.ocsh-bullet"));let t;t="critical"===i(n).data("priority")?s.text.ignore_critical:s.text.ignore,i(n).parents("li.ocsh-bullet").find(".onecom_unignore").addClass("oc-mark-resolved").removeClass("onecom_unignore").text(t);let o=i(n).parents("li.ocsh-bullet");o.toggleClass("expanded"),o.find(".ocsh-desc-wrap").toggleClass("hidden"),i(n).parents("li.ocsh-bullet").appendTo(c),i("#ignored_count").html(--s.counts.ignored),i("#todo_count").html(++s.counts.todo),i("#onecom_card_todo_score").html(s.counts.todo),s.updateListStatus()})))},updatedCounts:function(e){i("#onecom_card_result").html(e.score),i("#onecom_card_todo_score").html(e.todoCount)},updateListStatus:function(){var e=this;i(document).find(".onecom_empty_list").remove(),0===i("ul.todo li").length&&0===i("#todo .onecom_empty_list").length&&0===i("ul.critical li").length&&i("#todo").append(e.emptyListTemplate(e.emptyListMessages.todo)),0===i("ul.done li").length&&0===i("#done .onecom_empty_list").length&&i("#done").append(e.emptyListTemplate(e.emptyListMessages.done)),0===i("ul.ignored li").length&&0===i("#ignored .onecom_empty_list").length&&i("#ignored").append(e.emptyListTemplate(e.emptyListMessages.ignored))},validateInput:function(e){0===e.val().length?(i(e).parent().find(".oc-error-message").text(oc_constants.error_empty).fadeIn(),i(e).addClass("ocsh-error-field")):e.val().length<40?(i(e).parent().find(".oc-error-message").text(oc_constants.error_length).fadeIn(),i(e).addClass("ocsh-error-field")):(i(e).parent().find(".oc-error-message").text("").fadeOut(),i(e).removeClass("ocsh-error-field"))}};i(document).ready(function(){o.startScan(),o.scrollMenu(),i(".onecom_tab").click(function(e){o.handleTabClick(i(this))}),i(document).on("click",".ocsh-bullet",function(e){o.toggleBullet(i(this),e)}),i(document).on("click",".oc-mark-resolved ",function(e){o.actionTaken(i(this))||o.ignoreCheck(i(this))}),i(document).on("click",".onecom_unignore ",function(e){o.actionTaken(i(this))||o.unIgnore(i(this))}),i(document).on("click",".onecom__open-modal",function(e){let t=i(this).parents("li.ocsh-bullet").attr("id")||"ignore_list";t=t.replace("ocsh-",""),t=t.replace("check_",""),o.showModal(t)}),i(document).on("click",".oc-fix-button",function(e){o.actionTaken(i(this))||o.quickFix(i(this))}),i(document).on("click",".onecom__show_fields",function(e){o.showFields(i(this))}),i(document).on("click",".onecom__save_user",function(e){o.actionTaken(i(this))||o.saveUser(i(this))}),i(document).on("click",".ocsh-delete-link",function(e){o.actionTaken(i(this))||o.deleteFile(i(this))}),i(document).on("click",".onecom__revert_action",function(e){o.actionTaken(i(this))||o.revert(i(this))}),i(document).on("click",".oc_um_btn",function(e){i("body").removeClass("oc-noscroll")}),i(document).on("keyup","#oc_hm_site_key, #oc_hm_site_secret",function(e){o.validateInput(i(this))})})}(jQuery);