jQuery.fn.caret=function(e){var t=this[0],n="true"===t.contentEditable;if(0!=arguments.length)return-1==e&&(e=this[n?"text":"val"]().length),window.getSelection?n?(t.focus(),window.getSelection().collapse(t.firstChild,e)):t.setSelectionRange(e,e):document.body.createTextRange&&(n?((c=document.body.createTextRange()).moveToElementText(t),c.moveStart("character",e),c.collapse(!0)):(c=t.createTextRange()).move("character",e),c.select()),n||t.focus(),e;if(window.getSelection)return n?(t.focus(),(a=(o=window.getSelection().getRangeAt(0)).cloneRange()).selectNodeContents(t),a.setEnd(o.endContainer,o.endOffset),a.toString().length):t.selectionStart;if(document.selection){if(t.focus(),n){var o=document.selection.createRange();return(a=document.body.createTextRange()).moveToElementText(t),a.setEndPoint("EndToEnd",o),a.text.length}var e=0,c=t.createTextRange(),a=(a=document.selection.createRange().duplicate()).getBookmark();for(c.moveToBookmark(a);0!==c.moveStart("character",-1);)e++;return e}return t.selectionStart||0};
!function(m){m.fn.tagEditorInput=function(){var e=" ",i=m(this),a=parseInt(i.css("fontSize")),l=m("<span/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:i.css("fontSize"),fontFamily:i.css("fontFamily"),fontWeight:i.css("fontWeight"),letterSpacing:i.css("letterSpacing"),whiteSpace:"nowrap"});return l.insertAfter(i),i.bind("keyup keydown focus",function(){var t;e!==(e=i.val())&&(l.text(e),(t=(t=l.width()+a)<20?20:t)!=i.width()&&i.width(t))})},m.fn.tagEditor=function(a,l,r){function u(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}var p,v=m.extend({},m.fn.tagEditor.defaults,a);if(v.dregex=new RegExp("["+v.delimiter.replace("-","-")+"]","g"),"string"!=typeof a)return window.getSelection&&m(document).off("keydown.tag-editor").on("keydown.tag-editor",function(t){if(8==t.which||46==t.which||t.ctrlKey&&88==t.which){try{var e=getSelection(),a="INPUT"!=document.activeElement.tagName?m(e.getRangeAt(0).startContainer.parentNode).closest(".tag-editor"):0}catch(t){a=0}if(0<e.rangeCount&&a&&a.length){var l=[],r=e.toString().split(a.prev().data("options").dregex);for(i=0;i<r.length;i++){var n=m.trim(r[i]);n&&l.push(n)}return m(".tag-editor-tag",a).each(function(){~m.inArray(m(this).text(),l)&&m(this).closest("li").find(".tag-editor-delete").click()}),!1}}}),this.each(function(){function l(){!v.placeholder||d.length||m(".deleted, .placeholder, input",g).length||g.append('<li class="placeholder"><div>'+v.placeholder+"</div></li>")}function s(t){var e=d.toString();d=m(".tag-editor-tag:not(.deleted)",g).map(function(t,e){e=m.trim(m(this).hasClass("active")?m(this).find("input").val():m(e).text());return e||void 0}).get(),g.data("tags",d),c.val(d.join(v.delimiter[0])),t||e!=d.toString()&&v.onChange(c,g,d),l()}function r(t){for(var e,i=t.closest("li"),a=t.val().replace(/ +/," ").split(v.dregex),l=t.data("old_tag"),r=d.slice(0),n=!1,o=0;o<a.length;o++)if(h=m.trim(a[o]).slice(0,v.maxLength),v.forceLowercase&&(h=h.toLowerCase()),e=v.beforeTagSave(c,g,r,l,h),h=e||h,!1!==e&&h&&(v.removeDuplicates&&~m.inArray(h,r)&&m(".tag-editor-tag",g).each(function(){m(this).text()==h&&m(this).closest("li").remove()}),r.push(h),i.before('<li><div class="tag-editor-spacer">&nbsp;'+v.delimiter[0]+'</div><div class="tag-editor-tag">'+u(h)+'</div><div class="tag-editor-delete"><i></i></div></li>'),v.maxTags&&r.length>=v.maxTags)){n=!0;break}t.attr("maxlength",v.maxLength).removeData("old_tag").val(""),n?t.blur():t.focus(),s()}var c=m(this),d=[],g=m("<ul "+(v.clickDelete?'oncontextmenu="return false;" ':"")+'class="tag-editor"></ul>').insertAfter(c);c.addClass("tag-editor-hidden-src").data("options",v).on("focus.tag-editor",function(){g.click()}),g.append('<li style="width:1px">&nbsp;</li>');var t,e,f='<li><div class="tag-editor-spacer">&nbsp;'+v.delimiter[0]+'</div><div class="tag-editor-tag"></div><div class="tag-editor-delete"><i></i></div></li>';g.click(function(a,l){var r,n,o=99999;if(!window.getSelection||""==getSelection())return v.maxTags&&g.data("tags").length>=v.maxTags?g.find("input").blur():(p=!0,m("input:focus",g).blur(),p&&(p=!0,m(".placeholder",g).remove(),l&&l.length?n="before":m(".tag-editor-tag",g).each(function(){var t=m(this),e=t.offset(),i=e.left,e=e.top;a.pageY>=e&&a.pageY<=e+t.height()&&((r=a.pageX<i?(n="before",i-a.pageX):(n="after",a.pageX-i-t.width()))<o&&(o=r,l=t))}),("before"==n?m(f).insertBefore(l.closest("li")):"after"==n?m(f).insertAfter(l.closest("li")):m(f).appendTo(g)).find(".tag-editor-tag").click())),!1}),g.on("click",".tag-editor-delete",function(){if(m(this).prev().hasClass("active"))return m(this).closest("li").find("input").caret(-1),!1;var t=m(this).closest("li"),e=t.find(".tag-editor-tag");return!1===v.beforeTagDelete(c,g,d,e.text())||(e.addClass("deleted").animate({width:0},v.animateDelete,function(){t.remove(),l()}),s()),!1}),v.clickDelete&&g.on("mousedown",".tag-editor-tag",function(t){if(t.ctrlKey||1<t.which){var e=m(this).closest("li"),t=e.find(".tag-editor-tag");return!1===v.beforeTagDelete(c,g,d,t.text())||(t.addClass("deleted").animate({width:0},v.animateDelete,function(){e.remove(),l()}),s()),!1}}),g.on("click",".tag-editor-tag",function(t){return v.clickDelete&&(t.ctrlKey||1<t.which)||m(this).hasClass("active")||(e=m(this).text(),i=Math.abs((m(this).offset().left-t.pageX)/m(this).width()),t=parseInt(e.length*i),(i=m(this).html('<input type="text" maxlength="'+v.maxLength+'" value="'+u(e)+'">').addClass("active").find("input")).data("old_tag",e).tagEditorInput().focus().caret(t),v.autocomplete&&(t=m.extend({},v.autocomplete),a="select"in t?v.autocomplete.select:"",t.select=function(t,e){a&&a(t,e),setTimeout(function(){g.trigger("click",[m(".active",g).find("input").closest("li").next("li").find(".tag-editor-tag")])},20)},i.autocomplete(t))),!1;var e,i,a}),g.on("blur","input",function(t){t.stopPropagation();var e=m(this),i=e.data("old_tag"),a=m.trim(e.val().replace(/ +/," ").replace(v.dregex,v.delimiter[0]));if(a){if(0<=a.indexOf(v.delimiter[0]))return void r(e);if(a!=i)if(v.forceLowercase&&(a=a.toLowerCase()),cb_val=v.beforeTagSave(c,g,d,i,a),a=cb_val||a,!1===cb_val){if(i)return e.val(i).focus(),p=!1,void s();try{e.closest("li").remove()}catch(t){}i&&s()}else v.removeDuplicates&&m(".tag-editor-tag:not(.active)",g).each(function(){m(this).text()==a&&m(this).closest("li").remove()})}else{if(i&&!1===v.beforeTagDelete(c,g,d,i))return e.val(i).focus(),p=!1,void s();try{e.closest("li").remove()}catch(t){}i&&s()}e.parent().html(u(a)).removeClass("active"),a!=i&&s(),l()}),g.on("paste","input",function(){m(this).removeAttr("maxlength"),t=m(this),setTimeout(function(){r(t)},30)}),g.on("keypress","input",function(t){0<=v.delimiter.indexOf(String.fromCharCode(t.which))&&(e=m(this),setTimeout(function(){r(e)},20))}),g.on("keydown","input",function(t){var e,i,a=m(this);if((37==t.which||!v.autocomplete&&38==t.which)&&!a.caret()||8==t.which&&!a.val())return(e=a.closest("li").prev("li").find(".tag-editor-tag")).length?e.click().find("input").caret(-1):!a.val()||v.maxTags&&g.data("tags").length>=v.maxTags||m(f).insertBefore(a.closest("li")).find(".tag-editor-tag").click(),!1;if((39==t.which||!v.autocomplete&&40==t.which)&&a.caret()==a.val().length)return(i=a.closest("li").next("li").find(".tag-editor-tag")).length?i.click().find("input").caret(0):a.val()&&g.click(),!1;if(9==t.which){if(t.shiftKey){if((e=a.closest("li").prev("li").find(".tag-editor-tag")).length)e.click().find("input").caret(0);else{if(!a.val()||v.maxTags&&g.data("tags").length>=v.maxTags)return c.attr("disabled","disabled"),void setTimeout(function(){c.removeAttr("disabled")},30);m(f).insertBefore(a.closest("li")).find(".tag-editor-tag").click()}return!1}if((i=a.closest("li").next("li").find(".tag-editor-tag")).length)i.click().find("input").caret(0);else{if(!a.val())return;g.click()}return!1}if(!(46!=t.which||m.trim(a.val())&&a.caret()!=a.val().length))return(i=a.closest("li").next("li").find(".tag-editor-tag")).length?i.click().find("input").caret(0):a.val()&&g.click(),!1;if(13==t.which)return g.trigger("click",[a.closest("li").next("li").find(".tag-editor-tag")]),v.maxTags&&g.data("tags").length>=v.maxTags&&g.find("input").blur(),!1;if(36!=t.which||a.caret()){if(35==t.which&&a.caret()==a.val().length)g.find(".tag-editor-tag").last().click();else if(27==t.which)return a.val(a.data("old_tag")?a.data("old_tag"):"").blur(),!1}else g.find(".tag-editor-tag").first().click()});for(var i=v.initialTags.length?v.initialTags:c.val().split(v.dregex),a=0;a<i.length&&!(v.maxTags&&a>=v.maxTags);a++){var h=m.trim(i[a].replace(/ +/," "));h&&(v.forceLowercase&&(h=h.toLowerCase()),d.push(h),g.append('<li><div class="tag-editor-spacer">&nbsp;'+v.delimiter[0]+'</div><div class="tag-editor-tag">'+u(h)+'</div><div class="tag-editor-delete"><i></i></div></li>'))}s(!0),v.sortable&&m.fn.sortable&&g.sortable({distance:5,cancel:".tag-editor-spacer, input",helper:"clone",update:function(){s()}})});var n=[];return this.each(function(){var t=m(this),e=t.data("options"),i=t.next(".tag-editor");if("getTags"==a)n.push({field:t[0],editor:i,tags:i.data("tags")});else if("addTag"==a){if(e.maxTags&&i.data("tags").length>=e.maxTags)return!1;m('<li><div class="tag-editor-spacer">&nbsp;'+e.delimiter[0]+'</div><div class="tag-editor-tag"></div><div class="tag-editor-delete"><i></i></div></li>').appendTo(i).find(".tag-editor-tag").html('<input type="text" maxlength="'+e.maxLength+'">').addClass("active").find("input").val(l).blur(),r?m(".placeholder",i).remove():i.click()}else"removeTag"==a?(m(".tag-editor-tag",i).filter(function(){return m(this).text()==l}).closest("li").find(".tag-editor-delete").click(),r||i.click()):"destroy"==a&&t.removeClass("tag-editor-hidden-src").removeData("options").off("focus.tag-editor").next(".tag-editor").remove()}),"getTags"==a?n:this},m.fn.tagEditor.defaults={initialTags:[],maxTags:0,maxLength:50,delimiter:",;",placeholder:"",forceLowercase:!0,removeDuplicates:!0,clickDelete:!1,animateDelete:175,sortable:!0,autocomplete:null,onChange:function(){},beforeTagSave:function(){},beforeTagDelete:function(){}}}(jQuery);
!function(o){"use strict";var d={UI:{initialized:0,idwizard:"#ocvm-parent-wrap",ajaxurl:ocvmObj.ajaxurl,adminurl:ocvmObj.adminurl,clstab:"#ocvm-parent-wrap .onecom_tab",clstabpanel:".onecom_tabs_panel",clsEmailNotificationCard:".emailNotificationCard",clschangeUpdate:".changeUpdate",clsNotifyAdmin:".notifyAdmin",clsocvmbullet:".ocvm-bullet",clsocmarkdismiss:".oc-mark-dismiss",idAutoUpdate:"#ocvm_autoupdate_enable",idEmailNotificationEnable:"#ocvm_emailnotification_enable",idNotifyAdmin:"#ocvm-notifyAdmin",emailNotificationCheck:"ocvm_emailnotification_enable",iddetectvm:"#ocvm_vmdetectvunerability",idfixedvm:"#ocvm_vmautofix",clstextDesc:".otherEmail .textDesc",disabledSettingsWrap:"#settings.disabledSection"},_init:function(){d.UI.initialized||(d.UI.initialized=1,this.firstLoading())},firstLoading:function(){d.bindElement()},bindElement:function(){o(document).on("click",d.UI.clstab,function(e){d.handleTabClick(o(this))}),o(document).on("change",d.UI.clschangeUpdate,function(){if(!parseInt(ocvmObj.isPremium)){var e=location.search;return o("#oc_um_overlay").show(),ocSetModalData({isPremium:ocvmObj.isPremium,feature:"vulnerability_monitor",featureAction:"settings",referrer:e}),o(this).is(":checked")?d.disableFields(this):d.enableFields(this),!1}o(this).is(":checked")?d.enableFields(this):d.disableFields(this),d.emailNotificationSettings(this),d.spinnerShow(this),d.updateSettingsCall(this)}),o(document).on("click",d.UI.clsocvmbullet,function(e){d.toggleBulletMessage(o(this),e)}),o(document).on("click",d.UI.clsocmarkdismiss,function(e){d.dismissNotifications(o(this),e)})},scrollMenu:function(){if(o(".h-parent").length){const n=document.querySelector(".h-parent");let i=!1,t,a;n.addEventListener("mousedown",e=>{i=!0,n.classList.add("active"),t=e.pageX-n.offsetLeft,a=n.scrollLeft}),n.addEventListener("mouseleave",()=>{i=!1,n.classList.remove("active")}),n.addEventListener("mouseup",()=>{i=!1,n.classList.remove("active")}),n.addEventListener("mousemove",e=>{i&&(e.preventDefault(),e=3*(e.pageX-n.offsetLeft-t),n.scrollLeft=a-e,console.log(e))})}},emailNotificationSettings:function(e){o(e).attr("id")===d.UI.emailNotificationCheck&&o(e).is(":checked")?(d.enableFields(d.UI.iddetectvm),d.enableFields(d.UI.idfixedvm),d.enableFields("#ocvm-notifyAdmin")):o(e).attr("id")===d.UI.emailNotificationCheck&&o(e).is(":not(:checked)")&&(d.disableFields(d.UI.iddetectvm),d.disableFields(d.UI.idfixedvm),d.disableFields("#ocvm-notifyAdmin")),o(d.UI.iddetectvm).is(":not(:checked)")&&o(d.UI.idfixedvm).is(":not(:checked)")&&(d.disableFields(d.UI.idEmailNotificationEnable),d.disableFields("#ocvm-notifyAdmin"))},spinnerShow:function(e){o(e).closest(".checkSpinner").find(".spinner").addClass("is-active")},updateSettingsCall:function(i){var e=d.getFormData();d.ajax(e,function(e){void 0!==e.success&&!0===e.success?(o(i).closest(".checkSpinner").find(".spinner").removeClass("is-active").addClass("success"),setTimeout(d.removeClassSpinner,1200,i,"success")):(o(i).closest(".checkSpinner").find(".spinner").removeClass("is-active").addClass("error"),setTimeout(d.removeClassSpinner,1200,i,"error"))},"json",!0,0)},removeClassSpinner:function(e,i){o(e).closest(".checkSpinner").find(".spinner").removeClass(i)},getFormData(){return o("#ocvmForm").serialize()+"&action=ocvm_updateSettings"},handleTabClick:function(e){let i=o(e).attr("data-tab");o(d.UI.clstabpanel).fadeOut(function(){o(e).parent().find(".active").removeClass("active"),o(e).addClass("active"),o("#"+i).fadeIn()})},disableFields:function(e){o(e).prop("checked",!1),o(e).val(0),o(e).attr("id")===d.UI.emailNotificationCheck&&(o(d.UI.clsNotifyAdmin).addClass("disabledSection"),o("#ocvm-parent-wrap .notifyMeCard").addClass("disabledSection"))},enableFields:function(e){o(e).prop("checked",!0),o(e).val(1),o(e).attr("id")===d.UI.emailNotificationCheck&&(o(d.UI.clsNotifyAdmin).removeClass("disabledSection"),o("#ocvm-parent-wrap .notifyMeCard").removeClass("disabledSection"))},toggleBulletMessage:function(e,i=null){o(i.target).hasClass("onecom__scan-title-bg")&&o(e).toggleClass("expanded")},dismissNotifications:function(e,i){o(e).next().addClass("is-active");var t=o(e).attr("data-dismiss-name");d.ajax({action:"ocvm_dismissNotification",dismisstype:t},function(e){void 0!==e.success&&!0===e.success&&(o('a[data-dismiss-name="'+t+'"]').closest("li").remove(),e=o("#ocvm_count").attr("data-count"),e-=1,o("#ocvm_count").text(e),o("#ocvm_count").attr("data-count",e),e||o("#no_ocvm_vulneribilityFound").removeClass("hidden"))},"json",!0,0)},ajax:function(a,n,s,o,c){void 0===s&&(s="json"),!1!==o&&(o=!0);var l=1e4*(c=void 0===c?0:c);jQuery.ajax({url:d.UI.ajaxurl,type:"POST",dataType:s,cache:!1,data:a,error:function(e,i,t){console.log(e.status+" "+e.statusText+"---"+i+"---"+t),++c<=0?setTimeout(function(){d.ajax(a,n,s,o,c)},l):void 0===e.status||e.status},success:function(e){if("function"==typeof n)n(e);else if(""===n)return e},statusCode:{404:function(e){},500:function(){},504:function(){},502:function(){},503:function(){},429:function(){},403:function(){}}})}};jQuery(document).ready(function(){d._init(),d.scrollMenu(),o("#ocvm_otherEmail").tagEditor({initialTags:[],placeholder:"Add email",onChange:function(e,i,t){var a=!1,n=o(d.UI.clstextDesc).attr("data-error"),s=o(d.UI.clstextDesc).attr("data-msg");o("li",i).each(function(){var e=o(this),i=e.find(".tag-editor-tag").text();if(void 0!==i&&null!=i&&""!=i){const t=/^([\w-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,30}|[0-9]{1,30})(\]?)$/;t.test(String(i).toLowerCase())?(a=!0,o(d.UI.clstextDesc).text(s).removeClass("errorEmail")):(e.remove(),o(d.UI.clstextDesc).text(n).addClass("errorEmail"),a=!1,setTimeout(function(){o(d.UI.clstextDesc).text(s).removeClass("errorEmail")},2e3))}}),a&&(d.spinnerShow(e),d.updateSettingsCall(e))},beforeTagSave:function(e,i,t,a,n){},beforeTagDelete:function(e,i,t,a){}})})}(jQuery);