!function(o){"use strict";var d={UI:{initialized:0,idwizard:"#ocvm-parent-wrap",ajaxurl:ocvmObj.ajaxurl,adminurl:ocvmObj.adminurl,clstab:"#ocvm-parent-wrap .onecom_tab",clstabpanel:".onecom_tabs_panel",clsEmailNotificationCard:".emailNotificationCard",clschangeUpdate:".changeUpdate",clsNotifyAdmin:".notifyAdmin",clsocvmbullet:".ocvm-bullet",clsocmarkdismiss:".oc-mark-dismiss",idAutoUpdate:"#ocvm_autoupdate_enable",idEmailNotificationEnable:"#ocvm_emailnotification_enable",idNotifyAdmin:"#ocvm-notifyAdmin",emailNotificationCheck:"ocvm_emailnotification_enable",iddetectvm:"#ocvm_vmdetectvunerability",idfixedvm:"#ocvm_vmautofix",clstextDesc:".otherEmail .textDesc",disabledSettingsWrap:"#settings.disabledSection"},_init:function(){d.UI.initialized||(d.UI.initialized=1,this.firstLoading())},firstLoading:function(){d.bindElement()},bindElement:function(){o(document).on("click",d.UI.clstab,function(e){d.handleTabClick(o(this))}),o(document).on("change",d.UI.clschangeUpdate,function(){if(!parseInt(ocvmObj.isPremium)){var e=location.search;return o("#oc_um_overlay").show(),ocSetModalData({isPremium:ocvmObj.isPremium,feature:"vulnerability_monitor",featureAction:"settings",referrer:e}),o(this).is(":checked")?d.disableFields(this):d.enableFields(this),!1}o(this).is(":checked")?d.enableFields(this):d.disableFields(this),d.emailNotificationSettings(this),d.spinnerShow(this),d.updateSettingsCall(this)}),o(document).on("click",d.UI.clsocvmbullet,function(e){d.toggleBulletMessage(o(this),e)}),o(document).on("click",d.UI.clsocmarkdismiss,function(e){d.dismissNotifications(o(this),e)})},scrollMenu:function(){if(o(".h-parent").length){const n=document.querySelector(".h-parent");let i=!1,t,a;n.addEventListener("mousedown",e=>{i=!0,n.classList.add("active"),t=e.pageX-n.offsetLeft,a=n.scrollLeft}),n.addEventListener("mouseleave",()=>{i=!1,n.classList.remove("active")}),n.addEventListener("mouseup",()=>{i=!1,n.classList.remove("active")}),n.addEventListener("mousemove",e=>{i&&(e.preventDefault(),e=3*(e.pageX-n.offsetLeft-t),n.scrollLeft=a-e,console.log(e))})}},emailNotificationSettings:function(e){o(e).attr("id")===d.UI.emailNotificationCheck&&o(e).is(":checked")?(d.enableFields(d.UI.iddetectvm),d.enableFields(d.UI.idfixedvm),d.enableFields("#ocvm-notifyAdmin")):o(e).attr("id")===d.UI.emailNotificationCheck&&o(e).is(":not(:checked)")&&(d.disableFields(d.UI.iddetectvm),d.disableFields(d.UI.idfixedvm),d.disableFields("#ocvm-notifyAdmin")),o(d.UI.iddetectvm).is(":not(:checked)")&&o(d.UI.idfixedvm).is(":not(:checked)")&&(d.disableFields(d.UI.idEmailNotificationEnable),d.disableFields("#ocvm-notifyAdmin"))},spinnerShow:function(e){o(e).closest(".checkSpinner").find(".spinner").addClass("is-active")},updateSettingsCall:function(i){var e=d.getFormData();d.ajax(e,function(e){void 0!==e.success&&!0===e.success?(o(i).closest(".checkSpinner").find(".spinner").removeClass("is-active").addClass("success"),setTimeout(d.removeClassSpinner,1200,i,"success")):(o(i).closest(".checkSpinner").find(".spinner").removeClass("is-active").addClass("error"),setTimeout(d.removeClassSpinner,1200,i,"error"))},"json",!0,0)},removeClassSpinner:function(e,i){o(e).closest(".checkSpinner").find(".spinner").removeClass(i)},getFormData(){return o("#ocvmForm").serialize()+"&action=ocvm_updateSettings"},handleTabClick:function(e){let i=o(e).attr("data-tab");o(d.UI.clstabpanel).fadeOut(function(){o(e).parent().find(".active").removeClass("active"),o(e).addClass("active"),o("#"+i).fadeIn()})},disableFields:function(e){o(e).prop("checked",!1),o(e).val(0),o(e).attr("id")===d.UI.emailNotificationCheck&&(o(d.UI.clsNotifyAdmin).addClass("disabledSection"),o("#ocvm-parent-wrap .notifyMeCard").addClass("disabledSection"))},enableFields:function(e){o(e).prop("checked",!0),o(e).val(1),o(e).attr("id")===d.UI.emailNotificationCheck&&(o(d.UI.clsNotifyAdmin).removeClass("disabledSection"),o("#ocvm-parent-wrap .notifyMeCard").removeClass("disabledSection"))},toggleBulletMessage:function(e,i=null){o(i.target).hasClass("onecom__scan-title-bg")&&o(e).toggleClass("expanded")},dismissNotifications:function(e,i){o(e).next().addClass("is-active");var t=o(e).attr("data-dismiss-name");d.ajax({action:"ocvm_dismissNotification",dismisstype:t},function(e){void 0!==e.success&&!0===e.success&&(o('a[data-dismiss-name="'+t+'"]').closest("li").remove(),e=o("#ocvm_count").attr("data-count"),e-=1,o("#ocvm_count").text(e),o("#ocvm_count").attr("data-count",e),e||o("#no_ocvm_vulneribilityFound").removeClass("hidden"))},"json",!0,0)},ajax:function(a,n,s,o,c){void 0===s&&(s="json"),!1!==o&&(o=!0);var l=1e4*(c=void 0===c?0:c);jQuery.ajax({url:d.UI.ajaxurl,type:"POST",dataType:s,cache:!1,data:a,error:function(e,i,t){console.log(e.status+" "+e.statusText+"---"+i+"---"+t),++c<=0?setTimeout(function(){d.ajax(a,n,s,o,c)},l):void 0===e.status||e.status},success:function(e){if("function"==typeof n)n(e);else if(""===n)return e},statusCode:{404:function(e){},500:function(){},504:function(){},502:function(){},503:function(){},429:function(){},403:function(){}}})}};jQuery(document).ready(function(){d._init(),d.scrollMenu(),o("#ocvm_otherEmail").tagEditor({initialTags:[],placeholder:"Add email",onChange:function(e,i,t){var a=!1,n=o(d.UI.clstextDesc).attr("data-error"),s=o(d.UI.clstextDesc).attr("data-msg");o("li",i).each(function(){var e=o(this),i=e.find(".tag-editor-tag").text();if(void 0!==i&&null!=i&&""!=i){const t=/^([\w-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,30}|[0-9]{1,30})(\]?)$/;t.test(String(i).toLowerCase())?(a=!0,o(d.UI.clstextDesc).text(s).removeClass("errorEmail")):(e.remove(),o(d.UI.clstextDesc).text(n).addClass("errorEmail"),a=!1,setTimeout(function(){o(d.UI.clstextDesc).text(s).removeClass("errorEmail")},2e3))}}),a&&(d.spinnerShow(e),d.updateSettingsCall(e))},beforeTagSave:function(e,i,t,a,n){},beforeTagDelete:function(e,i,t,a){}})})}(jQuery);